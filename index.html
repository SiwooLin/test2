<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>관리자 로그인 + 노래책</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Jua', sans-serif, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
      text-align: center;
    }
    input, button, select {
      padding: 8px 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button {
      background-color: #ff6f00;
      color: #111;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #e65c00;
    }
    .hidden {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
      background-color: #222;
      color: #fff;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
    }
    th {
      background-color: #333;
      color: #ff6f00;
    }
    tr:hover {
      background-color: #444;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 12px;
    }
  </style>
</head>
<body>

  <h1>RIMO'S SONG BOOK</h1>

  <div id="loginSection">
    <p>관리자 모드 진입을 원하시면 비밀번호를 입력하세요.</p>
    <input type="password" id="passwordInput" placeholder="비밀번호 입력" />
    <br/>
    <button onclick="checkPassword()">로그인</button>
    <p id="loginMsg" style="color: #f66;"></p>
  </div>

  <div id="adminSection" class="hidden">
    <h2>관리자 페이지</h2>

    <form id="songForm">
      <label for="category">카테고리</label>
      <select id="category" required>
        <option value="">-- 선택하세요 --</option>
        <option value="Kpop">K-pop</option>
        <option value="Kpop 아이돌">K-pop 아이돌</option>
        <option value="Pop">Pop</option>
        <option value="기타">기타</option>
      </select>

      <label for="initial">이니셜 (첫 글자)</label>
      <select id="initial" required>
        <option value="">-- 선택하세요 --</option>
        <option>ㄱ</option><option>ㄴ</option><option>ㄷ</option><option>ㄹ</option>
        <option>ㅁ</option><option>ㅂ</option><option>ㅅ</option><option>ㅇ</option>
        <option>ㅈ</option><option>ㅊ</option><option>ㅋ</option><option>ㅌ</option>
        <option>ㅍ</option><option>ㅎ</option>
        <option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
        <option>F</option><option>G</option><option>H</option><option>I</option><option>J</option>
        <option>K</option><option>L</option><option>M</option><option>N</option><option>O</option>
        <option>P</option><option>Q</option><option>R</option><option>S</option><option>T</option>
        <option>U</option><option>V</option><option>W</option><option>X</option><option>Y</option><option>Z</option>
      </select>

      <label for="singer">가수 이름</label>
      <input type="text" id="singer" placeholder="예: 아이유" required />

      <label for="title">노래 제목</label>
      <input type="text" id="titleInput" placeholder="예: 밤편지" required />

      <label for="key">코드</label>
      <input type="text" id="key" placeholder="예: C, Am, G 등" />

      <label for="difficulty">난이도</label>
      <input type="text" id="difficulty" placeholder="예: 하, 중, 상" />

      <label for="skill">숙련도</label>
      <input type="text" id="skill" placeholder="예: 상, 중, 하" />

      <button type="submit" id="saveBtn">추가하기</button>
      <button type="button" id="deleteBtn" style="display:none; background-color:#aa2222; color:#fff;">삭제하기</button>
    </form>

    <table id="songsTable">
      <thead>
        <tr>
          <th>카테고리</th>
          <th>이니셜</th>
          <th>가수</th>
          <th>제목</th>
          <th>코드</th>
          <th>난이도</th>
          <th>숙련도</th>
        </tr>
      </thead>
      <tbody id="songsBody"></tbody>
    </table>

    <button onclick="logout()" style="margin-top:20px;">관리자 모드 종료</button>
  </div>

  <script>
    // 간단 XOR + Base64 난독화된 비밀번호 (원문: '123')
    const key = 'mysecret';
    const encryptedBase64 = 'FhgZFRUY'; // '123' XOR 암호화 후 Base64 인코딩

    function xorEncryptDecrypt(input, key) {
      let output = '';
      for(let i=0; i < input.length; i++) {
        output += String.fromCharCode(input.charCodeAt(i) ^ key.charCodeAt(i % key.length));
      }
      return output;
    }

    function checkPassword() {
      const input = document.getElementById('passwordInput').value;
      if(!input) {
        showLoginMsg('비밀번호를 입력해주세요.');
        return;
      }
      try {
        const decrypted = xorEncryptDecrypt(atob(encryptedBase64), key);
        if(input === decrypted) {
          // 로그인 성공
          document.getElementById('loginSection').classList.add('hidden');
          document.getElementById('adminSection').classList.remove('hidden');
          clearLoginMsg();
          loadSongs();
        } else {
          showLoginMsg('비밀번호가 틀렸습니다.');
        }
      } catch(e) {
        showLoginMsg('비밀번호 확인 중 오류가 발생했습니다.');
      }
    }

    function showLoginMsg(msg) {
      document.getElementById('loginMsg').textContent = msg;
    }
    function clearLoginMsg() {
      document.getElementById('loginMsg').textContent = '';
    }

    // 데이터 저장 (로컬 스토리지 사용)
    let songs = JSON.parse(localStorage.getItem('rimoSongs') || '[]');
    let editingIndex = -1;

    const form = document.getElementById('songForm');
    const categoryEl = document.getElementById('category');
    const initialEl = document.getElementById('initial');
    const singerEl = document.getElementById('singer');
    const titleEl = document.getElementById('titleInput');
    const keyEl = document.getElementById('key');
    const difficultyEl = document.getElementById('difficulty');
    const skillEl = document.getElementById('skill');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const tbody = document.getElementById('songsBody');

    function saveSongs() {
      localStorage.setItem('rimoSongs', JSON.stringify(songs));
    }

    function renderTable() {
      tbody.innerHTML = '';
      songs.forEach((song, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${song.category}</td>
          <td>${song.initial}</td>
          <td>${song.singer}</td>
          <td>${song.title}</td>
          <td>${song.key}</td>
          <td>${song.difficulty}</td>
          <td>${song.skill}</td>
        `;
        tr.addEventListener('click', () => loadSongToForm(idx));
        tbody.appendChild(tr);
      });
    }

    function loadSongToForm(idx) {
      const song = songs[idx];
      categoryEl.value = song.category;
      initialEl.value = song.initial;
      singerEl.value = song.singer;
      titleEl.value = song.title;
      keyEl.value = song.key;
      difficultyEl.value = song.difficulty;
      skillEl.value = song.skill;

      editingIndex = idx;
      saveBtn.textContent = '수정하기';
      deleteBtn.style.display = 'inline-block';
    }

    function resetForm() {
      form.reset();
      editingIndex = -1;
      saveBtn.textContent = '추가하기';
      deleteBtn.style.display = 'none';
    }

    form.addEventListener('submit', e => {
      e.preventDefault();

      if (!categoryEl.value || !initialEl.value || !singerEl.value.trim() || !titleEl.value.trim()) {
        alert('카테고리, 이니셜, 가수, 제목은 반드시 입력해야 합니다.');
        return;
      }

      const newSong = {
        category: categoryEl.value,
        initial: initialEl.value,
        singer: singerEl.value.trim(),
        title: titleEl.value.trim(),
        key: keyEl.value.trim(),
        difficulty: difficultyEl.value.trim(),
        skill: skillEl.value.trim()
      };

      if (editingIndex === -1) {
        songs.push(newSong);
        alert('노래가 추가되었습니다.');
      } else {
        songs[editingIndex] = newSong;
        alert('노래 정보가 수정되었습니다.');
      }

      saveSongs();
      renderTable();
      resetForm();
    });

    deleteBtn.addEventListener('click', () => {
      if (editingIndex === -1) return;
      if (confirm('정말 이 노래를 삭제하시겠습니까?')) {
        songs.splice(editingIndex, 1);
        saveSongs();
        renderTable();
        resetForm();
        alert('노래가 삭제되었습니다.');
      }
    });

    function loadSongs() {
      renderTable();
    }

    function logout() {
      if(confirm('관리자 모드를 종료하시겠습니까?')) {
        document.getElementById('adminSection').classList.add('hidden');
        document.getElementById('loginSection').classList.remove('hidden');
        resetForm();
        document.getElementById
